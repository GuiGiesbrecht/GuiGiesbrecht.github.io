<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Formul√°rio de CNPJ</title>
    <style>
      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          "Helvetica Neue", Arial, sans-serif;
        background: #f5f5f5;
        padding: 20px;
        margin: 0;
      }

      .container {
        max-width: 800px;
        margin: 0 auto;
        background: white;
        padding: 40px;
        border-radius: 16px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      h1 {
        color: #333;
        margin-bottom: 10px;
        text-align: center;
      }

      .subtitle {
        text-align: center;
        color: #666;
        margin-bottom: 30px;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        font-weight: 600;
        margin-bottom: 8px;
        color: #333;
      }

      input,
      select,
      textarea {
        width: 100%;
        padding: 12px 15px;
        border: 2px solid #eee;
        border-radius: 8px;
        font-size: 15px;
        transition: border-color 0.3s;
        box-sizing: border-box;
      }

      input:focus,
      select:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      input:disabled,
      select:disabled,
      textarea:disabled {
        background-color: #f9f9f9;
        cursor: not-allowed;
      }

      .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
      }

      .form-row-3 {
        display: grid;
        grid-template-columns: 1fr 2fr 1fr;
        gap: 15px;
      }

      button {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 15px 40px;
        font-size: 18px;
        font-weight: bold;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        display: block;
        margin: 30px auto 0;
        transition: transform 0.2s, box-shadow 0.2s;
      }

      button:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
      }

      button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .loading {
        text-align: center;
        color: #667eea;
        font-weight: 600;
        margin: 10px 0;
      }

      .error {
        background: #fee;
        color: #c33;
        padding: 12px;
        border-radius: 8px;
        margin: 10px 0;
        border: 1px solid #fcc;
      }

      .success {
        background: #d4edda;
        color: #155724;
        padding: 12px;
        border-radius: 8px;
        margin: 10px 0;
        border: 1px solid #c3e6cb;
      }

      .back-link {
        text-align: center;
        margin-top: 20px;
      }

      .back-link a {
        color: #667eea;
        text-decoration: none;
        font-weight: 600;
      }

      .back-link a:hover {
        text-decoration: underline;
      }

      @media (max-width: 768px) {
        .form-row,
        .form-row-3 {
          grid-template-columns: 1fr;
        }

        .container {
          padding: 20px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>üìã Consulta de CNPJ</h1>
      <p class="subtitle">
        Preencha o CNPJ para buscar automaticamente os dados da empresa
      </p>

      <form id="cnpjForm">
        <!-- CNPJ -->
        <div class="form-group">
          <label for="cnpj">CNPJ *</label>
          <input
            type="text"
            id="cnpj"
            name="cnpj"
            placeholder="00.000.000/0000-00"
            required
            maxlength="18"
          />
        </div>

        <div id="loadingMessage" class="loading" style="display: none">
          üîÑ Consultando CNPJ...
        </div>

        <div id="errorMessage" class="error" style="display: none"></div>
        <div id="successMessage" class="success" style="display: none"></div>

        <!-- Dados da Empresa -->
        <div class="form-row">
          <div class="form-group">
            <label for="razaoSocial">Raz√£o Social *</label>
            <input
              type="text"
              id="razaoSocial"
              name="razaoSocial"
              required
              disabled
            />
          </div>

          <div class="form-group">
            <label for="nomeFantasia">Nome Fantasia</label>
            <input type="text" id="nomeFantasia" name="nomeFantasia" disabled />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="dataFundacao">Data de Funda√ß√£o</label>
            <input type="text" id="dataFundacao" name="dataFundacao" disabled />
          </div>

          <div class="form-group">
            <label for="inscricaoEstadual">Inscri√ß√£o Estadual</label>
            <input
              type="text"
              id="inscricaoEstadual"
              name="inscricaoEstadual"
              disabled
            />
          </div>
        </div>

        <!-- Endere√ßo -->
        <div class="form-row-3">
          <div class="form-group">
            <label for="cep">CEP</label>
            <input type="text" id="cep" name="cep" disabled />
          </div>

          <div class="form-group">
            <label for="endereco">Endere√ßo</label>
            <input type="text" id="endereco" name="endereco" disabled />
          </div>

          <div class="form-group">
            <label for="bairro">Bairro</label>
            <input type="text" id="bairro" name="bairro" disabled />
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="municipio">Cidade</label>
            <input type="text" id="municipio" name="municipio" disabled />
          </div>

          <div class="form-group">
            <label for="uf">UF</label>
            <input type="text" id="uf" name="uf" disabled />
          </div>
        </div>

        <!-- CNAE -->
        <div class="form-row">
          <div class="form-group">
            <label for="cnae">CNAE</label>
            <input type="text" id="cnae" name="cnae" disabled />
          </div>

          <div class="form-group">
            <label for="desccnae">Descri√ß√£o CNAE</label>
            <input type="text" id="desccnae" name="desccnae" disabled />
          </div>
        </div>

        <!-- Email e contato -->
        <div class="form-row">
          <div class="form-group">
            <label for="email">Email Comercial *</label>
            <input
              type="email"
              id="email"
              name="email"
              placeholder="email@empresa.com.br"
              required
            />
          </div>

          <div class="form-group">
            <label for="telefone">Telefone *</label>
            <input
              type="tel"
              id="telefone"
              name="telefone"
              placeholder="(00) 00000-0000"
              required
            />
          </div>
        </div>

        <button type="submit" id="submitBtn">Enviar para HubSpot</button>
      </form>

      <div class="back-link">
        <a href="index.html">‚Üê Voltar para Home</a>
      </div>
    </div>

    <script>
      // Configura√ß√µes HubSpot e CNPJ√°
      const HUBSPOT_FORM_ID = "d5527aa6-9fdb-4aaa-8a25-78a44ad46f87"; // Substitua pelo ID real do formul√°rio
      const HUBSPOT_PORTAL_ID = "50600667";
      const CNPJA_API_KEY =
        "57f6d4e2-6fe9-4b6e-ae78-4e4dba79291d-361f7d69-d2ac-4851-b250-2961e3145d6b";

      // Elementos do DOM
      const cnpjInput = document.getElementById("cnpj");
      const form = document.getElementById("cnpjForm");
      const loadingMessage = document.getElementById("loadingMessage");
      const errorMessage = document.getElementById("errorMessage");
      const successMessage = document.getElementById("successMessage");
      const submitBtn = document.getElementById("submitBtn");

      // M√°scara de CNPJ
      cnpjInput.addEventListener("input", function (e) {
        let value = e.target.value.replace(/\D/g, "");

        if (value.length <= 14) {
          value = value.replace(/^(\d{2})(\d)/, "$1.$2");
          value = value.replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3");
          value = value.replace(/\.(\d{3})(\d)/, ".$1/$2");
          value = value.replace(/(\d{4})(\d)/, "$1-$2");
        }

        e.target.value = value;
      });

      // Consulta CNPJ ao sair do campo
      cnpjInput.addEventListener("blur", async function () {
        const cnpj = this.value.replace(/\D/g, "");

        if (cnpj.length === 14) {
          await consultarCNPJ(cnpj);
        }
      });

      // Fun√ß√£o para consultar CNPJ√° API
      async function consultarCNPJ(cnpj) {
        loadingMessage.style.display = "block";
        errorMessage.style.display = "none";

        try {
          const response = await fetch(
            `https://api.cnpja.com/office/${cnpj}?registrations=BR`,
            {
              method: "GET",
              headers: {
                Authorization: CNPJA_API_KEY,
              },
            }
          );

          if (!response.ok) {
            throw new Error("CNPJ n√£o encontrado ou erro na consulta");
          }

          const data = await response.json();
          preencherFormulario(data);
        } catch (error) {
          console.error("Erro ao consultar CNPJ:", error);
          errorMessage.textContent =
            "‚ùå Erro ao consultar CNPJ: " + error.message;
          errorMessage.style.display = "block";
        } finally {
          loadingMessage.style.display = "none";
        }
      }

      // Fun√ß√£o para preencher o formul√°rio com os dados
      function preencherFormulario(data) {
        // Converter data americana para brasileira (para exibi√ß√£o)
        let dataFundacaoDisplay = data.founded;
        if (dataFundacaoDisplay) {
          dataFundacaoDisplay = dataFundacaoDisplay
            .split("-")
            .reverse()
            .join("/");
        }

        // Preencher campos
        document.getElementById("razaoSocial").value = data.company.name || "";
        document.getElementById("nomeFantasia").value = data.alias || "";
        document.getElementById("dataFundacao").value =
          dataFundacaoDisplay || "";
        document
          .getElementById("dataFundacao")
          .setAttribute("data-iso-date", data.founded || ""); // Guardar data ISO original
        document.getElementById("cep").value = data.address.zip || "";
        document.getElementById("endereco").value = data.address.street || "";
        document.getElementById("municipio").value = data.address.city || "";
        document.getElementById("bairro").value = data.address.district || "";
        document.getElementById("uf").value = data.address.state || "";
        document.getElementById("cnae").value = data.mainActivity?.id || "";
        document.getElementById("desccnae").value =
          data.mainActivity?.text || "";

        // Inscri√ß√£o Estadual
        if (data.registrations && data.registrations.length > 0) {
          document.getElementById("inscricaoEstadual").value =
            data.registrations[0].number || "";
        }

        console.log("‚úÖ Dados do CNPJ carregados com sucesso!");
      }

      // Envio do formul√°rio para HubSpot
      form.addEventListener("submit", async function (e) {
        e.preventDefault();

        errorMessage.style.display = "none";
        successMessage.style.display = "none";
        submitBtn.disabled = true;
        submitBtn.textContent = "Enviando...";

        // Obter data ISO do atributo data (guardado durante o preenchimento)
        const dataFundacaoISO = document
          .getElementById("dataFundacao")
          .getAttribute("data-iso-date");

        // Converter data ISO para timestamp em milissegundos (formato esperado pelo HubSpot Date Picker)
        let dataFundacaoTimestamp = "";
        if (dataFundacaoISO) {
          const date = new Date(dataFundacaoISO);
          dataFundacaoTimestamp = date.getTime().toString(); // Timestamp em milissegundos
        }

        // Coletar dados do formul√°rio
        const formData = {
          fields: [
            { name: "cnpj", value: document.getElementById("cnpj").value },
            {
              name: "razao_social",
              value: document.getElementById("razaoSocial").value,
            },
            {
              name: "nome_fantasia",
              value: document.getElementById("nomeFantasia").value,
            },
            { name: "data_fundacao", value: dataFundacaoTimestamp }, // Enviar como timestamp
            {
              name: "inscricao_estadual",
              value: document.getElementById("inscricaoEstadual").value,
            },
            {
              name: "address",
              value: document.getElementById("endereco").value,
            },
            { name: "city", value: document.getElementById("municipio").value },
            { name: "state", value: document.getElementById("uf").value },
            { name: "zip", value: document.getElementById("cep").value },
            { name: "cnae", value: document.getElementById("cnae").value },
            { name: "email", value: document.getElementById("email").value },
            { name: "phone", value: document.getElementById("telefone").value },
          ],
          skipValidation: false,
          context: {},
        };

        try {
          const response = await fetch(
            `https://api.hsforms.com/submissions/v3/integration/submit/${HUBSPOT_PORTAL_ID}/${HUBSPOT_FORM_ID}`,
            {
              method: "POST",
              headers: {
                Accept: "application/json",
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            }
          );

          if (!response.ok) {
            throw new Error(`Erro HTTP: ${response.status}`);
          }

          const result = await response.json();
          console.log("‚úÖ Formul√°rio enviado com sucesso:", result);

          successMessage.textContent =
            "‚úÖ Dados enviados com sucesso para o HubSpot!";
          successMessage.style.display = "block";

          // Resetar formul√°rio ap√≥s 3 segundos
          setTimeout(() => {
            form.reset();
            successMessage.style.display = "none";
          }, 3000);
        } catch (error) {
          console.error("‚ùå Erro ao enviar para HubSpot:", error);
          errorMessage.textContent =
            "‚ùå Erro ao enviar dados: " + error.message;
          errorMessage.style.display = "block";
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Enviar para HubSpot";
        }
      });

      console.log("‚úÖ Formul√°rio de CNPJ carregado");
    </script>
  </body>
</html>
